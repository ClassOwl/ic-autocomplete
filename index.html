<!doctype html public "goods">
<meta charset="utf-8">
<title>ic-autocomplete demo</title>
<link rel="stylesheet" href="http://instructure.github.io/ic-ember/shared/styles.css">
<style>
ic-autocomplete { width: 200px; }
ic-autocomplete-list {
  max-height: 200px;
}

.image-block {
  overflow: hidden;
}

.image-block-image {
  float: left;
  margin-right: 6px;
}

.image-block-content {
  display: table-cell;
  vertical-align: top;
  width: 10000px;
}

#movies {
  width: 300px;
}

#movies ic-autocomplete-option {
  font-size: 14px;
}

#movies ic-autocomplete-list {
  max-height: 500px;
}

#movies ic-autocomplete-toggle {
  display: none;
}

#movies img {
  display: inline-block;
  padding-right: 10px;
  vertical-align: middle;
}
</style>

<header class="branding padbox">
  <h1>{{ic-autocomplete}}</h1>
  <h2>accessible ember autocomplete component</h2>
  <p>By <a target="_top" href="http://instructure.com">Instructure, Inc</a></p>
</header>

<a class="source-link" href="https://github.com/instructure/ic-autocomplete/blob/gh-pages/index.html">Demo Source</a>

<div id="demo" class="padbox"></div>

<a target="_top" href="https://github.com/instructure/ic-autocomplete"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github-camo.global.ssl.fastly.net/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>

<script type="text/x-handlebars">
  <p>
    State ID: {{state}}<br>
    Movie ID: {{movieId}}
  </p>

  {{#ic-autocomplete
    value=state
    on-input="filterStates"
    on-select="resetStates"
    placeholder="Enter or pick a state"
  }}
    {{#each filteredStates}}
      {{#ic-autocomplete-option value=id label=name}}{{name}}{{/ic-autocomplete-option}}
    {{else}}
      <div style="padding: 2px 16px;">No results</div>
    {{/each}}
  {{/ic-autocomplete}}

  {{#ic-autocomplete
    id="movies"
    value=movieId
    on-input="setMovieSearch"
    placeholder="Search for a movie"
  }}
    {{#if isLoading}}
      <div style="padding: 2px 16px;">Searching IMDB...</div>
    {{else}}
      {{#each movies}}
        {{#ic-autocomplete-option label=title value=id class="image-block"}}
          <img {{bind-attr src="image"}} height=50 class="image-block-image">
          <div class="image-block-content">
            {{title}}
          </div>
        {{/ic-autocomplete-option}}
      {{else}}
        <div style="padding: 2px 16px;">No results found</div>
      {{/each}}
    {{/if}}
  {{/ic-autocomplete}}

  <ul>
    <li>start typing to open the list</li>
    <li>or click the drop-down arrow</li>
    <li>up/down navigates the list</li>
    <li>esc closes the list</li>
    <li>enter + space selects focused items</li>
    <li>autocomplete text doesnâ€™t get in the way</li>
    <li>template is yielded, so you can put whatever you want in there</li>
    <li>you control the filtering so you can do xhr and even filter on
    multiple properties of your data (in this case, you can type the
    state abbreviation like "AZ"</li>
  </ul>
</script>

<script src="bower_components/jquery/dist/jquery.js"></script>
<script src="bower_components/handlebars/handlebars.js"></script>
<script src="bower_components/ember/ember.js"></script>
<script src="bower_components/ic-styled/main.js"></script>
<script src="bower_components/ic-autocomplete/dist/globals/main.js"></script>
<script>
  App = Ember.Application.create({ rootElement: '#demo' });

  App.ApplicationController = Ember.Controller.extend({

    state: 'UT',

    movieId: '',

    filteredStates: findStates(),

    actions: {
      filterStates: function(autocomplete, term) {
        this.set('filteredStates', this.filterStatesBy(term));
      },

      resetStates: function() {
        this.set('filteredStates', findStates());
      },

      setMovieSearch: throttle(function(autocomplete, term) {
        this.set('movieSearch', term);
      }, 500)
    },

    filterStatesBy: function(term) {
      var states = findStates();
      if (!term) return states;
      var filter = new RegExp('^'+term, 'i');
      return states.filter(function(state) {
        return filter.test(state.name) || filter.test(state.id);
      });
    },

    movies: function() {
      var movies = [];
      if (!this.get('movieSearch')) return movies;
      if (this.inflight) this.inflight.abort();
      this.set('isLoading', true);
      var url = 'http://movies-api.elasticbeanstalk.com/items/movies?q=';
      var req = this.inflight = $.getJSON(url + this.get('movieSearch'));
      req.done(function(data) {
        movies.addObjects(data);
      }).always(function() {
        this.set('isLoading', false);
        this.inflight = null;
      }.bind(this));
      return movies;
    }.property('movieSearch')

  });

  function findStates() {
    return [
      { id: "AL", name: "Alabama"},
      { id: "AK", name: "Alaska"},
      { id: "AZ", name: "Arizona"},
      { id: "AR", name: "Arkansas"},
      { id: "CA", name: "California"},
      { id: "CO", name: "Colorado"},
      { id: "CT", name: "Connecticut"},
      { id: "DE", name: "Delaware"},
      { id: "FL", name: "Florida"},
      { id: "GA", name: "Georgia"},
      { id: "HI", name: "Hawaii"},
      { id: "ID", name: "Idaho"},
      { id: "IL", name: "Illinois"},
      { id: "IN", name: "Indiana"},
      { id: "IA", name: "Iowa"},
      { id: "KS", name: "Kansas"},
      { id: "KY", name: "Kentucky"},
      { id: "LA", name: "Louisiana"},
      { id: "ME", name: "Maine"},
      { id: "MD", name: "Maryland"},
      { id: "MA", name: "Massachusetts"},
      { id: "MI", name: "Michigan"},
      { id: "MN", name: "Minnesota"},
      { id: "MS", name: "Mississippi"},
      { id: "MO", name: "Missouri"},
      { id: "MT", name: "Montana"},
      { id: "NE", name: "Nebraska"},
      { id: "NV", name: "Nevada"},
      { id: "NH", name: "New Hampshire"},
      { id: "NJ", name: "New Jersey"},
      { id: "NM", name: "New Mexico"},
      { id: "NY", name: "New York"},
      { id: "NC", name: "North Carolina"},
      { id: "ND", name: "North Dakota"},
      { id: "OH", name: "Ohio"},
      { id: "OK", name: "Oklahoma"},
      { id: "OR", name: "Oregon"},
      { id: "PA", name: "Pennsylvania"},
      { id: "RI", name: "Rhode Island"},
      { id: "SC", name: "South Carolina"},
      { id: "SD", name: "South Dakota"},
      { id: "TN", name: "Tennessee"},
      { id: "TX", name: "Texas"},
      { id: "UT", name: "Utah"},
      { id: "VT", name: "Vermont"},
      { id: "VA", name: "Virginia"},
      { id: "WA", name: "Washington"},
      { id: "WV", name: "West Virginia"},
      { id: "WI", name: "Wisconsin"},
      { id: "WY", name: "Wyoming"}
    ];
  }

  function throttle(fn, delay){
    var context, timeout, result, args,
      cur, diff, prev = 0;
    function delayed(){
      prev = Date.now();
      timeout = null;
      result = fn.apply(context, args);
    }
    function throttled(){
      context = this;
      args = arguments;
      cur = Date.now();
      diff = delay - (cur - prev);
      if (diff <= 0) {
        clearTimeout(timeout);
        prev = cur;
        result = fn.apply(context, args);
      } else if (! timeout) {
        timeout = setTimeout(delayed, diff);
      }
      return result;
    }
    throttled.cancel = function(){
      clearTimeout(timeout);
    };
    return throttled;
  }

</script>
